<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
  <title>Housing Prices Narative Visualization</title>
  <!-- <script src="js/d3.min.js"></script>
  <script src="js/d3-annotation.min.js"></script> -->
  <style>
     rect {
      pointer-events: all;
      fill-opacity: 0;
      stroke-opacity: 0;
      z-index: 1;
    }

    .tooltip {
      position: absolute;
      padding: 10px;
      background-color: steelblue;
      color: white;
      border: 1px solid white;
      border-radius: 10px;
      display: none;
      opacity: .90;
    }
  </style>
</head>

<body onload="init()">
  <div class="container">
    <div class="container jumbotron banner">
      <div class="header">
        <a style="color:black" href="./">
          <h1>The Effect of the Economy by State On Housing Prices</h1>
        </a>
        <p>Narrative Visualization by Edward Guo for CS 416</p>
      </div>
    </div>

    <div id="intro">
      <h2>Introduction</h2>
      <u1>
        <li>
          With the housing market not performing as well as it once was, an investigation into trends with the economy and changes within the last 25 years since 1997 would provide some insight into the current state of the housing market.
        </li>
        <li>
          An attempt to look into how the population for each state will be provided along with the GDP and household income of each state.
        </li>
        <li>
          This will be attempted within an interactive slideshow which will detail each of the metrics above and provide context behind those changes.
        </li>
      </u1>
      <br>
      <div class="mt-30">
        <em>Data: https://fred.stlouisfed.org/</em>
      </div>
      <hr>
    </div>
    
    <div class="row">
      <div class="col-sm wrapable">
        <div style="text-align: center;">
          <h3>House Price Index (HPI) vs Median Houshold Income by State in 2022</h3>
          <div id="chart">
            <svg id="plot" width="700" height="600"></svg>
            <svg id="legend" width="100" height="100"></svg>
          </div>
        </div>
      </div>
      <div class="col-sm">
        <div valign="top" class="wrapable right-panel wrapped">
          <nav style="display: inline;">
            <ul class="pagination pagination-sm">
              <li>
                <h4 style="margin-right: 10px;">Chart Navigation:</h4>
              </li>
              <li class="page-item"><a class="page-link" href="./">&lt;</a></li>
              <li class="page-item"><a class="page-link" href="./">1</a></li>
              <li class="page-item active"><a class="page-link" href="./housing_income.html">2</a></li>
              <li class="page-item"><a class="page-link" href="./housing_population.html">3</a></li>
              <li class="page-item"><a class="page-link" href="./housing_gdp.html">4</a></li>
              <li class="page-item"><a class="page-link" href="./housing_population.html">&gt;</a></li>
            </ul>
          </nav>
          <hr>
          <div id='annotations'>
            <h3>Annotations</h3>
            <h4>The increase in the house price index in the early 2000s</h4>
            <ul>
              <li>Increase in subprime mortgage lending</li>
              <li>The share of loans originated by lenders with dubious practices</li>
              <li>The availability of nontraditional funding sources</li>
              <li>The rise of private label securitization</li>
            </ul>
            <h4>The housing crash of 2008</h4>
            <ul>
              <li>Expansion of credit supply due to the originate-to-distribute model of securitization</li>
              <li>Lenders with poor origination practices</li>
              <li>The availability of funding through nontraditional sources and the rise in private-label securitization</li>
            </ul>
            <h4>Recent Increase in HPI</h4>
            <ul>
              <li>Low mortgage interest rates have made borrowing cheaper</li>
              <li>Shortage of available homes for sale</li>
              <li>Increased demand for housing</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function init() {
      var data = await d3.csv("./data/us_housing_income_gdp_2022_df.csv");

      console.log(data);
      console.log(data[0]);
      console.log(data[0].date);
      console.log(d3.timeParse("%Y-%m-%d")(data[0].date));

      data.forEach(d => {
        d.date = d3.timeParse("%Y-%m-%d")(d.date);
        d.hpi = parseFloat(d.hpi);
        d.hi = parseInt(d.hi);
        d.gdp = parseInt(d.gdp);
        d.pop = parseInt(d.pop);
      });

      console.log(data[0].date);

      var svg = d3.select("#plot")
        .append("g")
        .attr("transform", "translate(" + 50 + "," + 50 + ")");

      console.log(d3.min(data, function(d) { return d.hi; }), d3.max(data, function(d) { return d.hi; }));

      var x = d3.scaleLinear()
      .domain([45000, d3.max(data, function(d) { return d.hi; })])
      .range([ 0, 600 ]);
      svg.append("g")
      .attr("transform", "translate(0," + 500 + ")")
      .call(d3.axisBottom(x));

      svg.append("text")
      .attr("y", 530)
      .attr("x", 300)
      .style("text-anchor", "middle")
      .style("font-size", "14px")
      .style("fill", "#777")
      .style("font-family", "sans-serif")
      .text("Median Household Income");

      var y = d3.scaleLinear()
      .domain([250, d3.max(data, function(d) { return d.hpi; })])
      .range([ 500, 0 ]);
      svg.append("g")
      .call(d3.axisLeft(y));

      svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - 50)
      .attr("x", 0 - (500 / 2))
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .style("font-size", "14px")
      .style("fill", "#777")
      .style("font-family", "sans-serif")
      .text("House Price Index");

      // code from https://github.com/datavizdad/d3linechartseries/blob/main/Part3/scriptfinal.js
      // code from https://d3-graph-gallery.com/graph/scatter_tooltip.html
      const tooltip = d3.select("#chart").append("div").attr("class","tooltip");

      console.log(data[0].state, data[0].hpi)

      var offsets = document.getElementById('chart').getBoundingClientRect();
      var top = offsets.top;
      var left = offsets.left;

      nfObject = new Intl.NumberFormat('en-US');

      svg.append("g").selectAll("dot")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", function (d) { return x(d.hi); } )
        .attr("cy", function (d) { return y(d.hpi); } )
        .attr("r", function (d) { return 10; })
        .style("fill", function (d) {
          let division = d.division;

          if (division == "Pacific") {
            return "yellow";
          } else if (division == "Mountain") {
            return "teal";
          } else if (division == "West North Central") {
            return "pink";
          } else if (division == "West South Central") {
            return "brown";
          } else if (division == "East North Central") {
            return "blue";
          } else if (division == "East South Central") {
            return "orange";
          } else if (division == "New England") {
            return "green";
          } else if (division == "Middle Atlantic") {
            return "red";
          } else {
            return "purple";
          }
        })
        .style("stroke", "black")
        .style("opacity", 0.7)
      .on("mouseover", function() {
        tooltip.style("display", "block");
      })
      .on("mousemove", function(event, d) {
        const xPos = d3.pointer(event,this)[0]
        const yPos = d3.pointer(event,this)[1]

        tooltip.style("display", "block")
          .style("left", `${left + xPos + 75}px`)
          .style("top", `${top + yPos - 10}px`)
          .html(`<strong>State:</strong> ${d.state}<br>
            <strong>State Abbreviation:</strong> ${d.state_abbr}<br>
            <strong>Region:</strong> ${d.region}<br>
            <strong>Division:</strong> ${d.division}<br>
            <strong>HPI:</strong> ${d.hpi !== undefined ? d.hpi.toFixed(2) : 'N/A'}<br>
            <strong>Median Household Income:</strong> ${nfObject.format(d.hi)}<br>
            <strong>Income Range:</strong> ${d.ir}<br>
            <strong>GDP:</strong> ${d.gdp / 1.0e+6} M<br>
            <strong>Population:</strong> ${d.pop / 1.0e+6} M<br>`)
      })
      .on("mouseleave", function() {
        tooltip.transition()
          .duration(50)
          .style("display", "none");
      })
    }
  </script>
</body>

</html>